<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل السكربت</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Amiri', serif;
            background-color: #1a1a1a;
            color: white;
            margin: 0;
            padding: 0;
        }

        .navbar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #333;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .navbar a {
            text-decoration: none;
            color: white;
            font-size: 1.5rem;
        }

        .content {
            max-width: 900px;
            margin: 80px auto 40px;
            padding: 20px;
        }

        .title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 10px;
            color: #4caf50;
        }

        .description {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .instructions, .rating-section, .comments-section {
            margin-bottom: 20px;
        }

        .youtube-video {
            text-align: center;
            margin-bottom: 20px;
        }

        .youtube-video iframe {
            width: 100%;
            height: 400px;
        }

        .rating {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .rating input {
            display: none;
        }

        .rating label {
            font-size: 2rem;
            cursor: pointer;
            color: #ccc;
        }

        .rating input:checked ~ label,
        .rating label:hover,
        .rating label:hover ~ label {
            color: gold;
        }

        .comments {
            border-top: 1px solid #555;
            padding-top: 20px;
        }

        .comment {
            margin-bottom: 15px;
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
        }

        .footer {
            text-align: center;
            padding: 10px;
            background-color: #333;
        }

        .footer a {
            text-decoration: none;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <a href="#">🏠</a>
        <a href="#">📜</a>
        <a href="#">📩</a>
    </div>

    <!-- Content -->
    <div class="content">
        <h1 id="scriptTitle" class="title">تفاصيل السكربت</h1>
        <p id="scriptDescription" class="description"></p>

        <!-- Instructions -->
        <div class="instructions">
            <h2>إرشادات التثبيت</h2>
            <p id="scriptInstructions">سيتم تحميل الإرشادات...</p>
        </div>

        <!-- Video -->
        <div class="youtube-video">
            <iframe id="scriptVideo" src="" frameborder="0" allowfullscreen></iframe>
        </div>

        <!-- Rating -->
        <div class="rating-section">
            <h2>التقييم</h2>
            <div class="rating">
                <input type="radio" id="star5" name="rating" value="5"><label for="star5">⭐</label>
                <input type="radio" id="star4" name="rating" value="4"><label for="star4">⭐</label>
                <input type="radio" id="star3" name="rating" value="3"><label for="star3">⭐</label>
                <input type="radio" id="star2" name="rating" value="2"><label for="star2">⭐</label>
                <input type="radio" id="star1" name="rating" value="1"><label for="star1">⭐</label>
            </div>
            <button onclick="submitRating()">إرسال التقييم</button>
            <p id="ratingStats"></p>
        </div>

        <!-- Comments -->
        <div class="comments-section">
            <h2>التعليقات</h2>
            <textarea id="commentInput" rows="3" placeholder="اكتب تعليقك هنا..."></textarea>
            <button onclick="submitComment()">إرسال التعليق</button>
            <div id="comments" class="comments">
                <!-- سيتم تحميل التعليقات هنا -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>© جميع الحقوق محفوظة <a href="#">تيم هيما تيك</a></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDoK427q44Fj87JhgZh2vKeUnACkjl8HDc",
            authDomain: "treng-c6027.firebaseapp.com",
            projectId: "treng-c6027",
            storageBucket: "treng-c6027.appspot.com",
            messagingSenderId: "305527546716",
            appId: "1:305527546716:web:fd072a58200f31bb42d799",
            measurementId: "G-3JFKFT2LT0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const scriptId = new URLSearchParams(window.location.search).get("id");

        async function loadScriptDetails() {
            const doc = await db.collection("scripts").doc(scriptId).get();
            if (doc.exists) {
                const data = doc.data();
                document.getElementById("scriptTitle").textContent = data.title || "بدون عنوان";
                document.getElementById("scriptDescription").textContent = data.description || "بدون وصف";
                document.getElementById("scriptInstructions").textContent = data.instructions || "بدون إرشادات";
                document.getElementById("scriptVideo").src = data.videoUrl || "";
                loadComments();
            } else {
                alert("لم يتم العثور على السكربت.");
            }
        }

        function submitRating() {
            const rating = document.querySelector('input[name="rating"]:checked')?.value;
            if (!rating) return alert("يرجى اختيار تقييم.");
            db.collection("ratings").add({
                scriptId,
                rating: Number(rating),
                createdAt: new Date()
            }).then(() => alert("تم إرسال التقييم!"));
        }

        function loadComments() {
            db.collection("comments").where("scriptId", "==", scriptId).orderBy("createdAt", "desc").onSnapshot(snapshot => {
                const commentsContainer = document.getElementById("comments");
                commentsContainer.innerHTML = "";
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const commentDiv = document.createElement("div");
                    commentDiv.classList.add("comment");
                    commentDiv.innerHTML = `<p><strong>${data.username || "H-Scripts User 👤"}</strong></p><p>${data.comment}</p>`;
                    commentsContainer.appendChild(commentDiv);
                });
            });
        }

        function submitComment() {
            const comment = document.getElementById("commentInput").value.trim();
            if (!comment) return alert("يرجى إدخال تعليق.");
            db.collection("comments").add({
                scriptId,
                username: "H-Scripts User 👤",
                comment,
                createdAt: new Date()
            }).then(() => {
                document.getElementById("commentInput").value = "";
                alert("تم إرسال التعليق!");
            });
        }

        loadScriptDetails();
    </script>
</body>
</html>
